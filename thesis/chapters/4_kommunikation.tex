\chapter{Kommunikation}
\label{sec:kommunikation}

\subsection*{Übertragungstechnologie}
Da die Roboter, sowie auch die Controller über Funk mit dem Server kommunizieren sollten, gab es an dieser Stelle einige Entscheidungen. \\
Generell musste hierbei zwischen der Roboter-Server und der Controller-Server Kommunikation unterschieden werden. Für beide Wege gab es verschiedene Anforderungen. 
Da der Server in Nähe der Roboter aufgestellt werden soll spielt hierbei die Übertragungsdistanz keine sehr große Rolle, weshalb Bluetooth denkbar wäre, auch WLAN wäre eine gute Lösung, da in den meisten Gebäuden ein drahtloses Netzwerk vorhanden ist. Selbst optische Übertragungsverfahren wären denkbar (und werden sogar verwendet, siehe Kapitel %TODO ladestation
).

Die Hauptanforderungen an die Roboter-Server Übertragung sind Übertragungsgeschwindigkeit und Ausfallsicherheit. Eine energiesparende Lösung ist aufgrund der begrenzten Akkukapazität der Roboter wünschenswert. \\
Da die Roboter ständig in Bewegung sind und Richtungsänderungen schnell und zuverlässig verarbeitet werden sollen, wurde die optische Übertragung ausgeschlossen. Bei einem solchen Verfahren müsste ein ständiger Sichtkontakt zwischen Sender und Empfänger bestehen, was eine robuste Übertragung beim Fahren um Hindernisse nahezu ausschließt. \\
 Bluetooth würde die Anforderung der Ausfallsicherheit erfüllen, da die Roboter auf einem begrenzten Gebiet zum Einsatz kommen und die Distanz deshalb ausreichend gering wäre. Auch in Punkto Energieeffizienz wäre mit Bluetooth Low Energy eine gute Lösung gefunden, da es im Vergleich zu WLAN beim Senden nur in etwa ein sechstel des Stroms verbraucht %TODO( Quelle MUC )
. \\
WLAN bringt eine hohe Ausfallsicherheit, da die Verbindung in Gebäuden als nahezu Konstant anzunehmen ist. Da der Server im gleichen Netzwerk hängt wie der Roboter, ist es bei dieser Übertragung irrelevant wie weit die beiden Geräte tatsächlich voneinander entfernt sind, solange sie sich eben im selben Netzwerk befinden, was gegenüber Bluetooth mehr Spielraum für die Größe des Spielfeldes übrig lässt. Was die Übertragungsgeschwindigkeit angeht, ist WLAN um ein vielfaches schneller (stark von Version abhängig). \\

Aufgrund der besseren Flexibilität und der höheren Übertragungsrate fiel an dieser Stelle die Entscheidung auf \textbf{WLAN}. Der Vorteil von Bluetooth bestünde hier lediglich in der besseren Energieeffizienz, jedoch ist die Akkubelastung, die durch die Kommunikation eintritt im Vergleich zu der der Motoren wesentlich geringer. Dadurch fällt die vergleichsweise hohe Belastung von ca. 300mA bei WLAN im Gegensatz zu ca 50mA bei Bluetooth (beim Sendevorgang) nicht so sehr ins Gewicht, wie der Stromverbrauch, der durch die Motoren und den Schussapparat verursacht wird. %TODO nachfragen wieviel die überhaupt ziehen, nicht dass die kaum was brauchen und ich den akku mit befehlen leer zieh..


Für die Kommunikation zwischen Controller und Server gelten prinzipiell die gleichen Anforderungen, jedoch andere Rahmenbedingungen. Zusätzlich soll es möglich sein den Server mit seinem Controller auch außerhalb der Universität zu erreichen. Da die mobilen Endgeräte in den meisten Fällen ebenfalls über einen Akku mit Strom versorgt werden, spielt hier auch der Aspekt der Energieeffizienz eine Rolle. Weil die Controller den Server aber auch von weiter entfernten Orten erreichen sollen, die auch außerhalb der Universität liegen können, ist hier lediglich eine Kombination verschiedener Übertragungstechnologien möglich. Deshalb fiel die Entscheidung hierbei ebenfalls auf die Netzwerkvariante, da hiermit das Übertragungsmedium keine entscheidende Rolle spielt. So ist es zum Beispiel möglich sich von zu Hause mittels VPN Zugang zum Universitäts-Netzwerk zu verschaffen. Diese Entscheidung erlaubt es auf Netzwerkebene zu agieren, ohne sich über die Data-Link Layer Gedanken machen zu müssen.




\subsection*{Übertragungsprotokoll}
Nach der Entscheidung über die Übertragungstechnologie blieben für die Wahl des Übertragungsprotokolls grundlegend nur wenige Protokolle zur Auswahl. Diese sind UDP und TCP. Alle anderen denkbaren Protokolle basieren letztendlich auf einem der beiden und stellen nur Erweiterungen dar.

Bei der Roboter-Server Kommunikation gibt es hierbei einige Dinge zu berücksichtigen. In der Richtung Server-zu-Roboter werden Richtungsänderungen sowie der Befehl zum auslösen des Schussapparats übertragen. Damit Richtungsänderungen nicht auf dem Übertragungsweg verloren gehen wäre ein gesichertes Transportprotokoll die bessere Variante. Mittels TCP wäre hier garantiert, dass keine Pakete verloren gehen und Richtungsänderungen deswegen nicht ausgeführt werden können. Trotzdem wurde für das Übertragungsprotokoll \textbf{UDP} gewählt. Genauer betrachtet bedeutet die Ausfallsicherheit des TCP Protokolls keinen großen Vorteil für die zuverlässige Steuerung. Laut der Schnittstellendefinition %TODO schnittstellendefinition erstellen
gilt eine Befehlsfrequenz von 10Hz. Das bedeutet, wenn von zehn Paketen in einer Sekunde hin und wieder eines verloren geht, entsteht kurzzeitig eine Verzögerung von 100ms. Im Gegensatz zu TCP profitiert UDP allerdings von seiner Eigenschaft wenig Traffic zu verursachen. Da bei TCP jedes Paket bestätigt wird muss der Roboter jedes Paket mehrmals verarbeiten. Die Hardware des Roboters ist jedoch eher schwach bestückt, weshalb der hohe Traffic letzendlich zu längeren Verzögerungen führt als bei UDP. Deshalb ist es auch zu verkraften, dass gelegentliche Verzögerungen der Richtungsänderungen auftreten. Auch nach Betrachtung der anderen Übertragungsrichtung ist dies die bessere Entscheidung. In Roboter-zu-Server Richtung werden lediglich Statusänderungen, wie zum Beispiel der Akkustand, und Bilddaten der Kamera übertragen. Weder die Statusnachrichten noch die Bilddaten sind hier den Mehrtraffic wert, den TCP verursachen würde. Zumal allein die Größe der Bilddaten die Hardware des Roboters in kürze auslasten würde.


Die Anforderungen für die Controller-Server Kommunikation sind im Grunde die gleichen wie die der Roboter-Server Kommunikation. Diese werden jedoch noch darum erweitert, dass das Protokoll mit mehreren verschiedenen Clients kommunizieren soll. Da unter anderem eine Webanwendung einen Kommunikationspunkt darstellt, muss dieser Punkt bei der Entscheidung berücksichtigt werden. Im Gegensatz zu der Roboter-Server Kommunikation haben wir an dieser Stelle jedoch keinen leistungsschwachen Teilnehmer, weshalb TCP die bessere Variante ist. Weil mit der Webanwendung bereits ein hohes Maß an Abstraktion der niederen Datenstrukturen besteht, ist es nicht Ratsam dennoch ein Protokoll auf Byte-Ebene zu wählen, nicht zuletzt, da Javascript ohnehin keine direkte Client-Seitige Unterstützung für TCP oder UDP bietet. Die Lösung an dieser Stelle ist die Verwendung von \textbf{Websockets}. Diese basieren auf HTTP, was wiederum auf TCP basiert. Mit ihnen ist es möglich, innerhalb des Client-seitigen Codes mit Javascript eine bidirektionale Verbindung zu einem Socket aufzubauen.  