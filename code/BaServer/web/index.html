<html>
    <head>
        <title>RoboControl</title>
        <meta charset="windows-1252">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <script>
            
            var lastKeyDown;
            var command = {};
            var heldKeys = [];
            heldKeys[37] = "false";
            heldKeys[38] = "false";
            heldKeys[39] = "false";
            heldKeys[40] = "false";
            shot = "false";
            shotBreak = 0;
            
            
            var websocket;
            
            document.onkeyup = function(event) {
                
                if (event.keyCode < 41 && event.keyCode > 36) {                   
                    heldKeys[event.keyCode] = "false";
                }
                if (event.keyCode == 32) {
                    shot = "false";
                }
                
            }
            
            document.onkeydown = function(event) {
                
                if (heldKeys[event.keyCode] == "true") return;
                
                if (event.keyCode < 41 && event.keyCode > 36) {
                    heldKeys[event.keyCode] = "true";
                    lastKeyDown = event;
                }      
                if (event.keyCode == 32) {
                    shot = "true";
                }
                
            }
            createSocket();
            
            function createSocket() {
                websocket = new WebSocket("ws://localhost:8080/control/");
                websocket.onopen = function(evt) { onOpen(evt) };
                websocket.onclose = function(evt) { onClose(evt) };
                websocket.onmessage = function(evt) { onMessage(evt) };
                websocket.onerror = function(evt) { onError(evt) };
            }
            
            function onOpen(evt)
            {
                console.log("CONNECTED");
                setInterval(send, 100);
            }

            function onClose(evt)
            {
                console.log("DISCONNECTED");

            }

            function onMessage(evt)
            {
                console.log('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');

            }

            function onError(evt)
            {
                alert("Error occured! Please reload.");

            }


            function send() {
                
                command.controllerType = 1;
                command.shot = shot;
                command.up = heldKeys[38];
                command.left = heldKeys[37];
                command.right = heldKeys[39];
                command.down = heldKeys[40];
                console.log(JSON.stringify(command))
                
                websocket.send(JSON.stringify(command));
            }
        </script>
    </head>
    <body>   
        
    </body>
</html>
 